参考的项目代码结构

# pinyin2hanzi/

__ init __.py

implement.py    #定义默认的HMM参数类，设置模型参数的路径，以及查询HMM参数矩阵的对应值

interface.py       #提供给外界扩展的接口

viterbi.py           #实现viterbi算法

priorityset.py     #定义含优先级的集合，使用堆排序

util.py                #通用的小工具，包括设置python版本的兼容\一些字符串处理等等



### viterbi.py

主要变量 **V：[{}]** , 其中的元素dict{ }：key为state，value为一个堆，堆里面<u>每个节点</u> 是**从出发到当前状态的<u>每条</u>路径及对应概率**。即，V中的每个元素是某个时刻下，从0时刻的任一状态出发到达该时刻每个状态的概率及路径

为节省空间避免冗余，V的长度最多为2，即只存当前时刻和前一时刻【也是马尔科夫特性的体现】

##### 初始化

- t=0时刻，从各个状态出发的概率

##### 从t=1时刻到T时刻

- 首先判断当V中的长度到达2时，令V=[V[-1]]，即只保留V的最后一个元素。

- 计算从前一时刻的某个状态到当前时刻各个状态的概率，并存下整条路径。以当前时刻的状态作为key, value为一个堆

##### 最后结果

- 取V中的末尾元素，

- 将最后一个时刻各个状态以及该状态下对应的每条完整路径都保存到 结果堆

- 输出堆排序后的前N个概率最大的结果。



# train/hmm/

训练hmm的三个矩阵



## 语料库：

#### article文件夹    

- 收录各种文章的txt

#### sentence.txt    

- 从**article**中提取出来的中文句子列表

#### hanzipinyin.txt 

- 字典，统计了每个汉字对应的全部读音

#### word.txt        

- 词语库，统计了词语的词频



## 预处理：

#### process_article.py 

- 提取篇章中的所有中文句子，需要去除标点，且句子字数大于1

- 将结果保存到**sentence.txt**



#### process_hzpy.py

- 提取**hanzipinyin.txt**中出现的所有汉字作为所有状态，所有拼音作为所有观察值。分别保存成文件 

- 生成 **pinyin2hanzi.txt**。 格式是 拼音(or声母)=所有对应汉字，即以拼音或该拼音对应的声母作key，以其对应的汉字做value。【应该是给后续做viterbi用的，所以要以观察值为键；而构造HMM矩阵的时候用的是hanzipinyin.txt】



## 初始化

#### gen_base.py

生成初始的三个矩阵，只统计次数，还没算概率

#### start矩阵

从**sentence.txt**文件生成，要求句子为中文句，且字数至少为2。对于每个出现在句首的汉字，统计出现次数。

#### emission矩阵

从**hanzipinyin.txt**文件初始化，文件格式为 汉字=拼音1,拼音2,... 首先认为一个汉字的各个读音出现的次数是一样的；其次用**sentence.txt**文件校正：将句子转换为拼音串，对于句中每个汉字的相应读音次数加1。

#### transition矩阵

从**sentence.txt**文件生成，将前一个字A作为一级键，后一个字B为作为二级键，遍历整句一次，即可统计按照AB这一顺序排列的词组出现的次数。

将三个矩阵分别保存为json文件



## 最终结果

#### process_finally.py

根据初始化得到的三个矩阵，生成最终的概率矩阵

#### start矩阵

总数count除了将整个矩阵【是由篇章中的句子生成的，句子个数至少为2】每个字的出现次数求和之外，还加上了**hanzipinyin.txt**中的汉字个数，也就是算上了句子是单字的情况。

#### emission矩阵

又遍历了一次**hanzipinyin.txt**，也就是又重复了初始化emission时的第一步。统计每个汉字的所有读音出现的总数，求出每个汉字对应的各个读音出现的概率

#### transition矩阵

总数除了统计整个矩阵的汉字个数之外，还加上了**hanzipinyin.txt**中的汉字个数，即所有状态的个数，默认每个字都有机会。求出对应概率。

所有最终结果保存到json格式

将预处理阶段生成的**pinyin2hanzi.txt**保存成json格式





//代码具体细节：

dict.setdefault(key, value)，与get()方法类似，当key不存在时添加key且设置value，否则返回已存在的key值对应的value

set类型可以保证元素不重复，用来记录所有的汉字和所有的拼音